CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  clerk_user_id TEXT UNIQUE NOT NULL,
  name VARCHAR(100),
  email VARCHAR(255) UNIQUE NOT NULL,
  avatar_url TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE problems (
  id SERIAL PRIMARY KEY,
  user_id INT REFERENCES users(id) ON DELETE CASCADE,
  title VARCHAR(255) NOT NULL,
  description TEXT NOT NULL,
  budget NUMERIC(10,2) NOT NULL,
  deadline DATE NOT NULL,
  status VARCHAR(50) DEFAULT 'pending',
  attachment_url TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE solutions (
  id SERIAL PRIMARY KEY,
  problem_id INT REFERENCES problems(id) ON DELETE CASCADE,
  user_id INT REFERENCES users(id) ON DELETE CASCADE,
  code_url TEXT,
  explanation TEXT,
  status VARCHAR(50) DEFAULT 'pending_review',
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE payments (
  id SERIAL PRIMARY KEY,
  problem_id INT REFERENCES problems(id) ON DELETE CASCADE,
  payer_id INT REFERENCES users(id),
  payee_id INT REFERENCES users(id),
  amount NUMERIC(10,2) NOT NULL,
  status VARCHAR(50) DEFAULT 'escrow',
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE chats (
  id SERIAL PRIMARY KEY,
  problem_id INT REFERENCES problems(id) ON DELETE CASCADE,
  sender_id INT REFERENCES users(id),
  message TEXT NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE ai_verifications (
  id SERIAL PRIMARY KEY,
  solution_id INT REFERENCES solutions(id) ON DELETE CASCADE,
  checklist JSONB NOT NULL,
  overall_score NUMERIC(5,2),
  created_at TIMESTAMP DEFAULT NOW()
);
